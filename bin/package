#!/bin/sh

set -o errexit -o nounset

install() {
    if installed ${@}; then
        exit 0
    else
        apt-get update
        apt-get install --assume-yes ${@}
        apt-get autoremove --purge
        apt-get clean
        rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    fi
}

installed() {
    INSTALLED=true
    for PACKAGE in ${@}; do
        dpkg-query --show ${PACKAGE} >/dev/null 2>/dev/null || INSTALLED=false
    done
    eval ${INSTALLED}
}

usage() {
    echo 'usage: package <command> <package> [package ...]'
}

help() {
    cat <<EOF
$(usage)

  install      Install package(s) unless already installed
  installed    Exits 0 if all given packages are installed, 1 otherwise
EOF
}

case ${#} in
    0)
        usage;;
    1)
        case ${1} in
            help|--help|-h)
                help;;
            usage|--usage)
                usage;;
            install)
                echo 'usage: package install <package> [package ...]' >&2;;
            installed)
                echo 'usage: package installed [package ...]' >&2;;
            *)
                echo command ${1} not recognized >&2
                false;;
        esac;;
    *)
        eval ${@};;
esac
